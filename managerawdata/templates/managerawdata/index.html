{% extends "base.html" %}
{% block head %}
<title>原始数据管理</title>
<link href="/static/css/bootstrap-select.min.css" media="all" rel="stylesheet" type="text/css" />
<link href="/static/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />

    <style>
/* .slideThree */
.slideThree {
  width: 80px;
  height: 26px;
  background: #333;
  margin: 20px auto;
  position: relative;
  -moz-border-radius: 50px;
  -webkit-border-radius: 50px;
  border-radius: 50px;
  -moz-box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
  -webkit-box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
  box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
}
.slideThree:after {
  content: '单页';
  color: #000;
  position: absolute;
  right: 10px;
  z-index: 0;
  font: 12px/26px Arial, sans-serif;
  font-weight: bold;
  text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.15);
}
.slideThree:before {
  content: '双页';
  color: #00bf00;
  position: absolute;
  left: 10px;
  z-index: 0;
  font: 12px/26px Arial, sans-serif;
  font-weight: bold;
}
.slideThree label {
  display: block;
  width: 34px;
  height: 20px;
  cursor: pointer;
  position: absolute;
  top: 3px;
  left: 3px;
  z-index: 1;
  background: #fcfff4;
  background: -moz-linear-gradient(top, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
  background: -webkit-linear-gradient(top, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
  background: linear-gradient(to bottom, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
  -moz-border-radius: 50px;
  -webkit-border-radius: 50px;
  border-radius: 50px;
  -moz-transition: all 0.4s ease;
  -o-transition: all 0.4s ease;
  -webkit-transition: all 0.4s ease;
  transition: all 0.4s ease;
  -moz-box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.3);
  -webkit-box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.3);
  box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.3);
}
.slideThree input[type=checkbox] {
  visibility: hidden;
}
.slideThree input[type=checkbox]:checked + label {
  left: 43px;
}

/* end .slideThree */



</style>

{% endblock %}
{% block mainbody %}
<div class="container">


          <select id='Tripitaka' class="selectpicker show-menu-arrow" data-live-search="true" >
            <option >====大藏经===</option>
            {% for tri in tripitaka_list%}
            <option value='{{tri.id}}'>{{ tri.name}}</option>
            {% endfor %}
          </select>


          <select id='Volume' class="selectpicker show-menu-arrow" data-live-search="true" >
          </select>
    <form enctype="multipart/form-data" class="hidden">
        <div class="form-group">
			
		<div class="slideThree">  
		  <input type="checkbox" value="None" id="slideThree" name="page_type"  />
		  <label for="slideThree"></label>
		</div>
          <label for="start_page">起始页:</label>
          <input type="number" class="form-control" id="start_page">
        </div>
        <input id="imagefile" class="file" type="file" multiple >
    </form>
</div>

{% endblock %}
{% block foot  %}

<script src="/static/js/bootstrap-select.min.js"></script>

<!-- canvas-to-blob.min.js is only needed if you wish to resize images before upload.  This must be loaded before fileinput.min.js -->
<!-- script src="/static/js/plugins/canvas-to-blob.min.js" type="text/javascript"></script -->
<!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview.  This must be loaded before fileinput.min.js -->
<!-- script src="/static/js/plugins/sortable.min.js" type="text/javascript"></script -->
<!-- purify.min.js is only needed if you wish to purify HTML content in your preview for HTML files.  This must be loaded before fileinput.min.js -->
<!--script src="/static/js/plugins/purify.min.js" type="text/javascript"></script -->
<!-- the main fileinput plugin file -->
<script src="/static/js/fileinput.min.js" type="text/javascript"></script>
<!-- optionally if you need a theme like font awesome theme you can include it as mentioned below -->
<!-- script src="/static/themes/fa/theme.js"></script -->
<!-- optionally if you need translation for your language then include locale file as mentioned below -->
<script src="/static/js/locales/zh.js" type="text/javascript"></script>


<script>
var volumes = [];

$('#imagefile').fileinput({
    language: 'zh',
    uploadUrl: 'opage/upload',
    //allowedFileExtensions : ['jpg', 'png','gif'],
    //uploadExtraData: {'tripitaka_id': 1, 'volume_id': 2, 'start_page': 3},
});



$('#Tripitaka').on('changed.bs.select', function (e) {
  var request = $.getJSON({
        type: 'GET',
        url: '/api/tripitaka/' + e.target.value + '/',
    });
  request.done(function(data){

        $("#Volume").empty();
        $("#Volume").append(
                $("<option></option>").attr(
                    "value", "").text("--- 册` ---")
            );
        volumes = data.volumes;
       for (var i = 0; i < data.volumes.length; i++) {
            $("#Volume").append(
                $("<option></option>").attr(
                    "value", i).text(volumes[i].number)
            );
        }
        $('#Volume').selectpicker('refresh');
    });
});

function setExtraData(){
    var tripitaka_id = $('#Tripitaka').find("option:selected").attr("value");
    var volume_idx = $('#Volume').find("option:selected").attr("value");
    var volume_id = volumes[volume_idx].id;
    var start_page = $('#start_page').val() ;
    var page_type ;
    if(true == $("input[name='page_type']").prop('checked')){
        page_type = 2;
    }
    else{
        page_type = 1;
    }
    $('#imagefile').fileinput('refresh', 
        {
            allowedFileExtensions : ['jpg', 'png','gif'],
            uploadExtraData: {
                'tripitaka_id': tripitaka_id, 
                'volume_id': volume_id, 
                'start_page': start_page,
                'page_type': page_type,
            },
        }
    );
}

$('#Volume').on('changed.bs.select', function (e) {
    var volume_idx = $('#Volume').find("option:selected").attr("value");
    var start_page = parseInt(volumes[volume_idx].start_page);
    var end_page = parseInt(volumes[volume_idx].end_page);
    $("#start_page").val(start_page);
    $("#start_page").attr("min",start_page);
    $("#start_page").attr("max",end_page);
    $("form").removeClass("hidden");
});
$('#imagefile').on('change', function(event) {
    setExtraData();
});
</script>


{% endblock %}
