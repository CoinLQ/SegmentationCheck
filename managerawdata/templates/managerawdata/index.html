{% extends "base.html" %}
{% block head %}
<title>原始数据管理</title>
<link href="/static/css/bootstrap-select.min.css" media="all" rel="stylesheet" type="text/css" />
<link href="/static/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
{% endblock %}
{% block mainbody %}
<div class="container">


          <select id='Tripitaka' class="selectpicker" data-live-search="true" >
            {% for tri in tripitaka_list%}
            <option value='{{tri.id}}'>{{ tri.name}}</option>
            {% endfor %}
          </select>


          <select id='Volume' class="selectpicker" data-live-search="true" >
          </select>
    <form enctype="multipart/form-data" class="hidden">
        <div class="form-group">
          <label for="page">起始页:</label>
          <input type="number" class="form-control" id="start_page">
        </div>
        {% csrf_token %}
        <input id="imagefile" class="file hidden" type="file" multiple >
    </form>
</div>

{% endblock %}
{% block foot  %}

<script src="/static/js/bootstrap-select.min.js"></script>

<!-- canvas-to-blob.min.js is only needed if you wish to resize images before upload.  This must be loaded before fileinput.min.js -->
<!-- script src="/static/js/plugins/canvas-to-blob.min.js" type="text/javascript"></script -->
<!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview.  This must be loaded before fileinput.min.js -->
<!-- script src="/static/js/plugins/sortable.min.js" type="text/javascript"></script -->
<!-- purify.min.js is only needed if you wish to purify HTML content in your preview for HTML files.  This must be loaded before fileinput.min.js -->
<!--script src="/static/js/plugins/purify.min.js" type="text/javascript"></script -->
<!-- the main fileinput plugin file -->
<script src="/static/js/fileinput.min.js" type="text/javascript"></script>
<!-- optionally if you need a theme like font awesome theme you can include it as mentioned below -->
<!-- script src="/static/themes/fa/theme.js"></script -->
<!-- optionally if you need translation for your language then include locale file as mentioned below -->
<script src="/static/js/locales/zh.js" type="text/javascript"></script>


<script>
var tripitaka_id = $('#Tripitaka').find("option:selected").attr("value");
var volume_id, start_page;

$('#imagefile').fileinput({
    language: 'zh',
    uploadUrl: 'opage/upload',
    //allowedFileExtensions : ['jpg', 'png','gif'],

    uploadExtraData: {tripitaka_id: tripitaka_id,
        volume_id: volume_id, start_page: start_page},
});

$('#Tripitaka').on('changed.bs.select', function (e) {
  var request = $.getJSON({
        type: 'GET',
        url: '/api/tripitaka/' + e.target.value + '/',
    });
  request.done(function(data){

        $("#Volume").empty();
        $("#Volume").append(
                $("<option></option>").attr(
                    "value", "").text("--- Select One ---")
            );
        var volumes = data.volumes;
       for (var i = 0; i < data.volumes.length; i++) {
            $("#Volume").append(
                $("<option></option>").attr(
                    "value", volumes[i].id).text(volumes[i].number)
            );
        }
        $("#start_page").val("56");
        $('#Volume').selectpicker('refresh');
    });
});

$('#Volume').on('changed.bs.select', function (e) {
    $("form").removeClass("hidden");
    });
</script>


{% endblock %}
